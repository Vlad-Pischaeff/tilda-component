{"version":3,"sources":["../src/index.ts","../src/TildaComponent.tsx","../src/TildaComponent.module.scss"],"sourcesContent":["export { TildaComponent } from \"./TildaComponent\";\nexport type { Tilda } from \"./TildaComponent\";","import { useEffect, useRef } from \"react\";\nimport styles from \"./TildaComponent.module.scss\";\n\nexport type Tilda = {\n  css: string[];\n  js: string[];\n  promoBlockId: number;\n  content: string;\n};\n\ntype BlobProps = {\n  cssArr: string[];\n  jsArr: string[];\n  id: number;\n};\n\ntype IframeElement = HTMLIFrameElement & {\n  initHTML?: () => string;\n};\n\ntype Props = { tilda: Tilda; className?: string };\n\nexport const TildaComponent = ({ tilda, className }: Props) => {\n  const ref = useRef<IframeElement>(null);\n\n  const getGeneratedPageURL = ({ cssArr, jsArr, id }: BlobProps) => {\n    const getBlobURL = (code: string, type: string) => {\n      const blob = new Blob([code], { type });\n      return URL.createObjectURL(blob);\n    };\n\n    const getCSS = (cssArray: string[]) =>\n      cssArray\n        .map((css) => `<link rel=\"stylesheet\" type=\"text/css\" href=\"${css}\" />`)\n        .join(\" \");\n\n    const getJS = (jsArray: string[]) =>\n      jsArray\n        .map((js) => `<script src=\"${js}\" blocking=\"render\"></script>`)\n        .join(\" \");\n\n    const source = `\n      <html>\n        <head>\n          ${getCSS(cssArr)}\n          ${getJS(jsArr)}\n        </head>\n        <body style=\"overflow: hidden\">\n          <div id=\"tilda\">tilda body content</div>\n          <script>\n            const EL = document.getElementById('tilda');\n            const IFRAME = window.parent.document.getElementById('iframe${id}');\n            const setHTML = (html) => {\n              const range = document.createRange();\n              range.selectNode(EL);\n              const documentFragment = range.createContextualFragment(html);\n              EL.innerHTML = '';\n              EL.append(documentFragment);\n            };\n            document.onreadystatechange = () => {\n              if (document.readyState === \"complete\") {\n                const html = IFRAME.initHTML();\n                setHTML(html);\n              }\n            };\n            const resizeObserver = new ResizeObserver((entries) => {\n              for (const entry of entries) {\n                IFRAME.style.height = entry.target.clientHeight + 30 +'px';\n              }\n            });\n            resizeObserver.observe(EL);\n            window.addEventListener('unload', () => resizeObserver.disconnect());\n          </script>\n        </body>\n      </html>\n    `;\n\n    return getBlobURL(source, \"text/html\");\n  };\n\n  useEffect(() => {\n    let url = \"\";\n    if (ref.current) {\n      url = getGeneratedPageURL({\n        cssArr: tilda.css,\n        jsArr: tilda.js,\n        id: tilda.promoBlockId,\n      });\n      ref.current.src = url;\n      ref.current.initHTML = () => tilda.content;\n    }\n    return () => {\n      if (url) URL.revokeObjectURL(url);\n    };\n  }, [tilda]);\n\n  return (\n    <div className={className ? className : styles.container}>\n      <iframe\n        ref={ref}\n        style={{ width: '100%' }}\n        id={`iframe${tilda.promoBlockId}`}\n      />\n    </div>\n  );\n};",".container {\n  width: 100%;\n  overflow: hidden;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,mBAAkC;;;ACAlC;;;ADkGM;AA5EC,IAAM,iBAAiB,CAAC,EAAE,OAAO,UAAU,MAAa;AAC7D,QAAM,UAAM,qBAAsB,IAAI;AAEtC,QAAM,sBAAsB,CAAC,EAAE,QAAQ,OAAO,GAAG,MAAiB;AAChE,UAAM,aAAa,CAAC,MAAc,SAAiB;AACjD,YAAM,OAAO,IAAI,KAAK,CAAC,IAAI,GAAG,EAAE,KAAK,CAAC;AACtC,aAAO,IAAI,gBAAgB,IAAI;AAAA,IACjC;AAEA,UAAM,SAAS,CAAC,aACd,SACG,IAAI,CAAC,QAAQ,gDAAgD,GAAG,MAAM,EACtE,KAAK,GAAG;AAEb,UAAM,QAAQ,CAAC,YACb,QACG,IAAI,CAAC,OAAO,gBAAgB,EAAE,+BAA+B,EAC7D,KAAK,GAAG;AAEb,UAAM,SAAS;AAAA;AAAA;AAAA,YAGP,OAAO,MAAM,CAAC;AAAA,YACd,MAAM,KAAK,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0EAMkD,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0BxE,WAAO,WAAW,QAAQ,WAAW;AAAA,EACvC;AAEA,8BAAU,MAAM;AACd,QAAI,MAAM;AACV,QAAI,IAAI,SAAS;AACf,YAAM,oBAAoB;AAAA,QACxB,QAAQ,MAAM;AAAA,QACd,OAAO,MAAM;AAAA,QACb,IAAI,MAAM;AAAA,MACZ,CAAC;AACD,UAAI,QAAQ,MAAM;AAClB,UAAI,QAAQ,WAAW,MAAM,MAAM;AAAA,IACrC;AACA,WAAO,MAAM;AACX,UAAI;AAAK,YAAI,gBAAgB,GAAG;AAAA,IAClC;AAAA,EACF,GAAG,CAAC,KAAK,CAAC;AAEV,SACE,4CAAC,SAAI,WAAW,YAAY,YAAY,8BAAO,WAC7C;AAAA,IAAC;AAAA;AAAA,MACC;AAAA,MACA,OAAO,EAAE,OAAO,OAAO;AAAA,MACvB,IAAI,SAAS,MAAM,YAAY;AAAA;AAAA,EACjC,GACF;AAEJ;","names":[]}